var e=require("react");function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}var r=0;function n(e){return"__private_"+r+++"_"+e}function o(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var i=/*#__PURE__*/n("apiURL"),u=/*#__PURE__*/n("appURL"),a=/*#__PURE__*/n("authenticateEndpoint"),s=/*#__PURE__*/n("userInfoEndpoint"),c=/*#__PURE__*/n("mode"),l=/*#__PURE__*/n("ssoURL"),h=/*#__PURE__*/n("preflightURL"),f=/*#__PURE__*/n("redirectPath"),d=/*#__PURE__*/n("localStorageKey"),p=/*#__PURE__*/n("bearerTokenKey"),v=/*#__PURE__*/n("originSourceQuery"),g=new(/*#__PURE__*/function(){function e(e){var t=(void 0===e?{}:e).apiURL;Object.defineProperty(this,i,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:window.location.origin}),Object.defineProperty(this,a,{writable:!0,value:"/api/authenticate/"}),Object.defineProperty(this,s,{writable:!0,value:"/api/user-info/"}),Object.defineProperty(this,c,{writable:!0,value:"production"}),Object.defineProperty(this,l,{writable:!0,value:"https://sso.tga.gov.tr"}),Object.defineProperty(this,h,{writable:!0,value:"https://preflight.tga.gov.tr"}),Object.defineProperty(this,f,{writable:!0,value:"/"}),Object.defineProperty(this,d,{writable:!0,value:"token"}),Object.defineProperty(this,p,{writable:!0,value:"Bearer"}),Object.defineProperty(this,v,{writable:!0,value:""}),o(this,i)[i]=t||""}var t,r,n=e.prototype;return n.setupOriginSource=function(e){o(this,v)[v]=null==e?void 0:e.replaceAll("https://","").replaceAll("http://","")},n.setupSSOModeAndURL=function(e){o(this,c)[c]=e,o(this,l)[l]="development"===e?"https://tga-sso-frontend-dev.arge-tga.com":"https://sso.tga.gov.tr"},n.redirectSSO=function(e,t,r){if(void 0===r&&(r=!1),!r){e&&console.error(e),localStorage.removeItem(o(this,d)[d]);var n=window.location;window.open(g.ssoURL+"/login?url="+n.host+("localhost"===n.hostname?"&origin="+g.originSourceQuery:""),"_self"),t&&t()}},n.configure=function(e){o(this,i)[i]=e.apiURL||o(this,i)[i],o(this,u)[u]=e.appURL||o(this,u)[u],o(this,a)[a]=e.authenticateEndpoint||o(this,a)[a],o(this,s)[s]=e.userInfoEndpoint||o(this,s)[s],o(this,h)[h]=e.preflightURL||o(this,h)[h],o(this,f)[f]=e.redirectPath||o(this,f)[f],o(this,d)[d]=e.localStorageKey||o(this,d)[d],o(this,p)[p]=e.bearerTokenKey||o(this,p)[p],this.setupOriginSource(e.originSourceQuery||o(this,v)[v]),this.setupSSOModeAndURL(e.mode||o(this,c)[c])},t=e,(r=[{key:"appURL",get:function(){return o(this,u)[u]}},{key:"apiURL",get:function(){return o(this,i)[i]}},{key:"authenticateEndpoint",get:function(){return o(this,a)[a]}},{key:"userInfoEndpoint",get:function(){return o(this,s)[s]}},{key:"preflightURL",get:function(){return o(this,h)[h]}},{key:"ssoURL",get:function(){return o(this,l)[l]}},{key:"mode",get:function(){return o(this,c)[c]}},{key:"localStorageKey",get:function(){return o(this,d)[d]}},{key:"bearerTokenKey",get:function(){return o(this,p)[p]}},{key:"originSourceQuery",get:function(){return o(this,v)[v]}},{key:"redirectPath",get:function(){return o(this,f)[f]}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()),y=function(e,r){try{var n=r.timeout,o=void 0===n?25e3:n,i=new AbortController,u=setTimeout(function(){return i.abort()},o);return Promise.resolve(fetch(e,t({},r,{signal:i.signal,headers:t({"Content-Type":"application/json"},r.headers)}))).then(function(e){return clearTimeout(u),e})}catch(e){return Promise.reject(e)}};exports.SSO=g,exports.useAuth=function(t,r,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var o=e.useState(!1),i=o[0],u=o[1],a=e.useState(!1),s=a[0],c=a[1],l=e.useState(null),h=l[0],f=l[1],d=e.useRef(),p=e.useRef(g.redirectPath),v=e.useCallback(function(e,t){try{return Promise.resolve(y(""+g.apiURL+g.authenticateEndpoint,{signal:t,method:"POST",body:JSON.stringify({token:e})})).then(function(e){return Promise.resolve(e.json()).then(function(e){var t;return null!=e&&e.success?(localStorage.setItem(g.localStorageKey,JSON.stringify(null==e||null==(t=e.data)?void 0:t.token)),u(!0),null==e?void 0:e.data):g.redirectSSO("autheticate !data?.success on :35",void 0,n)})})}catch(e){return Promise.reject(e)}},[]),b=e.useCallback(function(e){try{return Promise.resolve(y(""+g.apiURL+g.userInfoEndpoint,{signal:e,method:"GET",headers:{Authorization:g.bearerTokenKey+" "+JSON.parse(localStorage.getItem(g.localStorageKey))}})).then(function(e){return Promise.resolve(e.json()).then(function(e){return null!=e&&e.success?(p.current=window.location.pathname,u(!0),null==e?void 0:e.data):g.redirectSSO("userInfo !data.success on :59",void 0,n)})})}catch(e){return Promise.reject(e)}},[]),m=e.useCallback(function(){try{c(!0);var e=JSON.parse(localStorage.getItem(g.localStorageKey)),t=new URLSearchParams(window.location.search).get("token");return Promise.resolve(e||t?function(o,i){try{var u=function(n,o){try{var i=(d.current=new AbortController,Promise.resolve(e?b(d.current.signal):v(t,d.current.signal)).then(function(e){f(e),r&&r(e)}))}catch(e){return o()}return i&&i.then?i.then(void 0,o):i}(0,function(){return localStorage.removeItem(g.localStorageKey),g.redirectSSO("handleAuth catch error on :82",void 0,n)})}catch(e){return i(!0,e)}return u&&u.then?u.then(i.bind(null,!1),i.bind(null,!0)):i(!1,u)}(0,function(e,t){if(c(!1),window.history.pushState({},document.title,p.current),e)throw t;return t}):g.redirectSSO("handleAuth !token && !ssoToken on :71",void 0,n))}catch(e){return Promise.reject(e)}},[]);return e.useEffect(function(){if(t)return m(),function(){var e;"production"===g.mode&&(null==(e=d.current)||e.abort())}},[t]),{isAuthed:i,isAuthing:s,user:h}},exports.usePreflight=function(){var t=e.useState(!1),r=t[0],n=t[1],o=e.useState(!0),i=o[0],u=o[1],a=e.useRef();return e.useEffect(function(){return function(){try{var e=function(e,t){try{var r=function(e,t){try{var r=(a.current=new AbortController,Promise.resolve(y(g.preflightURL,{signal:a.current.signal,method:"GET",timeout:25e3})).then(function(e){return Promise.resolve(e.json()).then(function(t){e.ok&&t.success&&n(!0)})}))}catch(e){return t()}return r&&r.then?r.then(void 0,t):r}(0,function(){n(!1)})}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(0,function(e,t){if(u(!1),e)throw t;return t});Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){var e;"production"===g.mode&&(null==(e=a.current)||e.abort())}},[]),{isPreflighting:i,isAllowed:r}};
