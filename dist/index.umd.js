!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t||self).ssoClient={},t.react)}(this,function(t,e){function r(){return r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},r.apply(this,arguments)}var n=0;function i(t){return"__private_"+n+++"_"+t}function o(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var u=/*#__PURE__*/i("appURL"),a=/*#__PURE__*/i("apiURL"),s=/*#__PURE__*/i("authenticateEndpoint"),c=/*#__PURE__*/i("userInfoEndpoint"),l=/*#__PURE__*/i("mode"),h=/*#__PURE__*/i("ssoURL"),f=/*#__PURE__*/i("preflightURL"),p=/*#__PURE__*/i("redirectPath"),d=/*#__PURE__*/i("localStorageKey"),g=/*#__PURE__*/i("originSourceQuery"),v=/*#__PURE__*/function(){function t(){Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,s,{writable:!0,value:"/api/authenticate/"}),Object.defineProperty(this,c,{writable:!0,value:"/api/user-info/"}),Object.defineProperty(this,l,{writable:!0,value:"production"}),Object.defineProperty(this,h,{writable:!0,value:"https://sso.tga.gov.tr"}),Object.defineProperty(this,f,{writable:!0,value:"https://preflight.tga.gov.tr/api/preflight/"}),Object.defineProperty(this,p,{writable:!0,value:"/"}),Object.defineProperty(this,d,{writable:!0,value:"token"}),Object.defineProperty(this,g,{writable:!0,value:""})}var e,r,n=t.prototype;return n.setupOriginSource=function(t){o(this,g)[g]=null==t?void 0:t.replaceAll("https://","").replaceAll("http://","")},n.setupSSOModeAndURL=function(t){o(this,l)[l]=t,o(this,h)[h]="development"===t?"https://tga-sso-frontend-dev.arge-tga.com":"https://sso.tga.gov.tr"},n.configure=function(t){o(this,u)[u]=t.appURL||o(this,u)[u],o(this,a)[a]=t.apiURL||o(this,a)[a],o(this,s)[s]=t.authenticateEndpoint||o(this,s)[s],o(this,c)[c]=t.userInfoEndpoint||o(this,c)[c],o(this,f)[f]=t.preflightURL||o(this,f)[f],o(this,p)[p]=t.redirectPath||o(this,p)[p],o(this,d)[d]=t.localStorageKey||o(this,d)[d],this.setupOriginSource(t.originSourceQuery||o(this,g)[g]),this.setupSSOModeAndURL(t.mode||o(this,l)[l])},e=t,(r=[{key:"appURL",get:function(){return o(this,u)[u]}},{key:"apiURL",get:function(){return o(this,a)[a]}},{key:"authenticateEndpoint",get:function(){return o(this,s)[s]}},{key:"userInfoEndpoint",get:function(){return o(this,c)[c]}},{key:"preflightURL",get:function(){return o(this,f)[f]}},{key:"ssoURL",get:function(){return o(this,h)[h]}},{key:"mode",get:function(){return o(this,l)[l]}},{key:"localStorageKey",get:function(){return o(this,d)[d]}},{key:"originSourceQuery",get:function(){return o(this,g)[g]}},{key:"redirectPath",get:function(){return o(this,p)[p]},set:function(t){o(this,p)[p]=t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,"symbol"==typeof(i=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key))?i:String(i),n)}var i}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),y=function(t,e){try{var n=e.timeout,i=void 0===n?25e3:n,o=new AbortController,u=setTimeout(function(){return o.abort()},i);return Promise.resolve(fetch(t,r({},e,{signal:o.signal,headers:r({"Content-Type":"application/json"},e.headers)}))).then(function(t){return clearTimeout(u),t})}catch(t){return Promise.reject(t)}},b=function(){var t=window.location;window.open(m.ssoURL+"/login?url="+t.host+("localhost"===t.hostname?"&origin="+m.originSourceQuery:""),"_self")},m=new v;t.SSO=m,t.useAuth=function(t){void 0===t&&(t=!0);var r=e.useState(!1),n=r[0],i=r[1],o=e.useState(!1),u=o[0],a=o[1],s=e.useState(null),c=s[0],l=s[1],h=e.useRef(function(){}),f=e.useRef(m.redirectPath),p=e.useCallback(function(t,e){try{return Promise.resolve(y(""+m.apiURL+m.authenticateEndpoint,{signal:e,method:"POST",body:JSON.stringify({token:t})})).then(function(t){return Promise.resolve(t.json()).then(function(t){var e;return null!=t&&t.success?(localStorage.setItem(m.localStorageKey,JSON.stringify(null==t||null==(e=t.data)?void 0:e.token)),i(!0),null==t?void 0:t.data):b()})})}catch(t){return Promise.reject(t)}},[]),d=e.useCallback(function(t){try{return Promise.resolve(y(""+m.apiURL+m.userInfoEndpoint,{signal:t,method:"GET",headers:{Authorization:"Token "+JSON.parse(localStorage.getItem(m.localStorageKey))}})).then(function(t){return Promise.resolve(t.json()).then(function(t){return t.success?(i(!0),f.current=window.location.pathname,null==t?void 0:t.data):b()})})}catch(t){return Promise.reject(t)}},[]),g=e.useCallback(function(){try{a(!0);var t=JSON.parse(localStorage.getItem(m.localStorageKey)),e=new URLSearchParams(window.location.search).get("token");return Promise.resolve(t||e?function(r,n){try{var i=function(r,n){try{var i=(u=(o=new AbortController).signal,h.current=o.abort,Promise.resolve(t?d(u):p(e,u)).then(function(t){l(t)}))}catch(t){return n()}var o,u;return i&&i.then?i.then(void 0,n):i}(0,function(){return localStorage.removeItem(m.localStorageKey),b()})}catch(t){return n(!0,t)}return i&&i.then?i.then(n.bind(null,!1),n.bind(null,!0)):n(!1,i)}(0,function(t,e){if(a(!1),window.history.pushState({},document.title,f.current),t)throw e;return e}):b())}catch(t){return Promise.reject(t)}},[]);return e.useEffect(function(){if(t)return g(),function(){"production"===m.mode&&h.current()}},[t]),{isAuthed:n,isAuthing:u,user:c}},t.usePreflight=function(){var t=e.useState(!1),r=t[0],n=t[1],i=e.useState(!0),o=i[0],u=i[1],a=e.useRef(function(){});return e.useEffect(function(){return function(){try{var t=function(t,e){try{var r=function(t,e){try{var r=(o=(i=new AbortController).signal,a.current=i.abort,Promise.resolve(y(m.preflightURL,{signal:o,method:"GET",timeout:25e3})).then(function(t){return Promise.resolve(t.json()).then(function(e){t.ok&&e.success&&n(!0)})}))}catch(t){return e()}var i,o;return r&&r.then?r.then(void 0,e):r}(0,function(){n(!1)})}catch(t){return e(!0,t)}return r&&r.then?r.then(e.bind(null,!1),e.bind(null,!0)):e(!1,r)}(0,function(t,e){if(u(!1),t)throw e;return e});Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(t){return Promise.reject(t)}}(),function(){"production"===m.mode&&a.current()}},[]),{isPreflighting:o,isAllowed:r}}});
